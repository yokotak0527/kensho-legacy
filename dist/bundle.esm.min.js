const e=new Map,t={add(t,r){e.set(t,r)},get(t){const r=e.get(t);if(void 0===r)throw new Error(`Rule "${t}" is not found.`);return r},delete(t){e.delete(t)}},r=new Map,n={add(e,t){r.set(e,t)},get(e){const t=r.get(e);if(void 0===t)throw new Error(`Plugin "${e}" is not found.`);return t},delete(e){r.delete(e)}};var i=Object.freeze({__proto__:null,required:e=>"string"==typeof e?""!==e.trim():"number"==typeof e||(Array.isArray(e)?0!==e.length:"object"==typeof e&&null!==e?0!==Object.keys(e).length:void 0!==e&&null!==e),empty:e=>"string"==typeof e?""===e:"number"!=typeof e&&(Array.isArray(e)?0===e.length:"object"==typeof e&&null!==e?0===Object.keys(e).length:void 0===e),regexp:(e,{regexp:t})=>t.test(e),email:(e,t,r)=>r.validate("regexp",e,{regexp:/^(([^<>()[\]\\.,;:\s@"]+(\.[^<>()[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/}),list:(e,{list:t},r)=>{let n=!1;for(let i=0,o=t.length;i<o;i++)if(e instanceof RegExp){if(n=r.validate("regexp",t[i],{regexp:e}),n)break}else if(e===t[i]){n=!0;break}return n},number:e=>"number"==typeof e||""!==e.trim()&&!Number.isNaN(1*e),integer:(e,t,r)=>!!r.validate("number",e)&&("string"==typeof e&&(e=parseInt(e,10)),e%1==0),naturalNumber:(e,{zero:t=!1},r)=>!!r.validate("integer",e)&&("string"==typeof e&&(e=parseInt(e,10)),!(!t||0!==e)||e>0),positiveNumber:(e,t,r)=>!!r.validate("number",e)&&("string"==typeof e&&(e=parseInt(e,10)),e>0),negativeNumber:(e,t,r)=>!!r.validate("number",e)&&("string"==typeof e&&(e=parseInt(e,10)),e<0),zero:(e,t,r)=>!!r.validate("number",e)&&("string"==typeof e&&(e=parseInt(e,10)),0===e),age:(e,{max:t=125},r)=>!!r.validate("naturalNumber",e,{zero:!0})&&("string"==typeof e&&(e=parseInt(e,10)),e<=t),equal:(e,{others:t,isInput:r=!0})=>{let n=!0;"string"==typeof t&&(t=[t]);for(const i of t){let t;if(t=r?document.querySelector(i).value:i,e!==t){n=!1;break}}return n},letters:(e,{range:t={}})=>{if((t=Object.assign({min:-1,max:-1},t)).min="string"==typeof t.min?parseInt(t.min,10):t.min,t.max="string"==typeof t.max?parseInt(t.max,10):t.max,t.min<0&&t.max<0)throw new Error("To use the letters rule, you need to specify number that is 0 or more for either `range.min` or `range.max`");if(t.min<0&&t.max>=0)return e.length<=t.max;if(t.min>=0&&t.max<0)return e.length>=t.min;if(t.min>t.max)throw new Error("You cannot specify a number larger than `range.max` in `range.min`");return t.min>=0&&t.max>=0&&(e.length>=t.min&&e.length<=t.max)}});const o={};Object.assign(o,{"０":"0","１":"1","２":"2","３":"3","４":"4","５":"5","６":"6","７":"7","８":"8","９":"9"}),Object.assign(o,{"ａ":"a","ｂ":"b","ｃ":"c","ｄ":"d","ｅ":"e","ｆ":"f","ｇ":"g","ｈ":"h","ｉ":"i","ｊ":"j","ｋ":"k","ｌ":"l","ｍ":"m","ｎ":"n","ｏ":"o","ｐ":"p","ｑ":"q","ｒ":"r","ｓ":"s","ｔ":"t","ｕ":"u","ｖ":"v","ｗ":"w","ｘ":"x","ｙ":"y","ｚ":"z"}),Object.assign(o,{"Ａ":"A","Ｂ":"B","Ｃ":"C","Ｄ":"D","Ｅ":"E","Ｆ":"F","Ｇ":"G","Ｈ":"H","Ｉ":"I","Ｊ":"J","Ｋ":"K","Ｌ":"L","Ｍ":"M","Ｎ":"N","Ｏ":"O","Ｐ":"P","Ｑ":"Q","Ｒ":"R","Ｓ":"S","Ｔ":"T","Ｕ":"U","Ｖ":"V","Ｗ":"W","Ｘ":"X","Ｙ":"Y","Ｚ":"Z"}),Object.assign(o,{"－":"-","（":"(","）":")","＿":"_","／":"/","＋":"+","：":":","；":";","］":"]","［":"[","＠":"@","！":"!","＜":"<","＞":">","？":"?","｛":"{","｝":"}","＊":"*","”":'"',"’":"'","〜":"~","＾":"^","￥":"¥","｜":"|","＆":"&","％":"%","＃":"#","＄":"$","　":" ","＝":"="});const s=(e,t)=>{const r=t.charCodeAt(0),n=r>=0&&r<129||63728===r||r>=65377&&r<65440||r>=63729&&r<63732;return e?n:!n};var a=Object.freeze({__proto__:null,charWidthMapAssign:function(e){Object.assign(o,e)},half2full:function(e){return e.split("").map(e=>{let t=e;if(this.use("is2byte",e))return t;for(const[r,n]of Object.entries(o))if(n===e){t=r;break}return t}).join("")},full2half:function(e){return e.split("").map(e=>{let t=e;if(this.use("is1byte",e))return t;for(const[r,n]of Object.entries(o))if(r===e){t=n;break}return t}).join("")},is1byte:e=>s(!0,e),is2byte:function(e){return s(!1,e)},squash:function(e,t=!1){const r=t?/([^\S]|[\t\n])+/gm:/([^\S]|\t)+/gm;return e.trim().replace(r,"")}});const l=i,u=(()=>{const e=[],t=()=>{let r="k_"+Math.floor(1e3*Math.random()).toString().padStart(4,"0");return"string"==typeof e.find(e=>e===r)&&(r=t()),r};return()=>{const r=t();return e.push(r),r}})();class p{constructor(e,t={}){if(t=Object.assign({search:!0},t),"string"==typeof e){const t=document.querySelector(e);if(null===t)throw new Error(`form "${e}" is not found.`);e=t}return this.form=e,p.config.autocomplete||this.form.setAttribute("autocomplete","off"),this.inputsRules=new Map,this.form.classList.add("kensho-form"),t.search&&this.addFromCustomAttrs(this.search()),this}static validate(e,...t){const r=p.rule.get(e);return void 0===t[1]?r(t[0],{},p):r(t[0],t[1],p)}static use(e,...t){return p.plugin.get(e).bind(p)(...t)}addFromCustomAttrs(e){const t=p.config.customAttrPrefix;for(const[r,n]of Object.entries(e)){if(void 0!==this.inputsRules.get(r))throw new Error(`The "${r}" rule unit is already exsisted.`);const e=n.input,i=r,o=n.error,s=e.getAttribute(t+"rule");if(null===s)throw new Error(`The \`k-rule\` attribute is not found in the element where \`k-name="${r}"\` is specified.`);const a=this.parseAttrStr2Arr(s);let l=n.input;"radio"===n.input.getAttribute("type")&&(l=this.form.querySelectorAll(`input[name="${n.input.getAttribute("name")}"]`));let u=null!==e.getAttribute(t+"event")?e.getAttribute(t+"event"):void 0;"string"==typeof u&&(u=this.parseAttrStr2Arr(u));const p=u;let f=null!==e.getAttribute(t+"message")?e.getAttribute(t+"message"):void 0;"string"==typeof f&&(f=f.trim().replace(/\n/gm,"").replace(/'/g,'"'),/^{.+}$/.test(f)&&(f=JSON.parse(f)));const m=f;let c,g=null!==e.getAttribute(t+"filter")?e.getAttribute(t+"filter"):void 0;"string"==typeof g&&(g=this.parseAttrStr2Arr(g),c=function(e,t){for(const r of g)e="string"==typeof r?t.use(r,e):t.use(r[0],e,...r[1]);return e});const h={inputElement:l,errorElement:o,errorMessage:m,rule:a,event:p,valueFilter:c,name:i};this.add(h)}}search(){const e=p.config.customAttrPrefix,t=this.form.querySelectorAll(`*[${e}name]`),r={};for(const n of t){let t=n.getAttribute(e+"name");const i=/\.error$/.test(t)?"error":"input";"error"===i&&(t=t.replace(".error","")),void 0===r[t]&&(r[t]={}),"input"===i?(void 0!==r[t].input&&console.error(`There are two or more \`k-name\` attributes of the same value. "${t}"`),r[t].input=n):"error"===i&&(void 0!==r[t].error&&console.error(`There are two or more \`k-name\` attributes of the same value. "${t}.error"`),r[t].error=n)}const n={};for(const[e,t]of Object.entries(r))void 0!==t.input?n[e]=t:console.error(`No \`k-name="${e}"\` attribute in HTML input form against \`k-name="${e}.error"\``);return n}add(e){if("string"==typeof e.inputElement){const t=e.inputElement;if(e.inputElement=this.form.querySelectorAll(t),0===e.inputElement.length)throw new Error(`inputElement parameter "${t}" is not found in the form.`)}if(e.inputElement instanceof HTMLInputElement)e.inputElement=[e.inputElement];else if(e.inputElement instanceof HTMLSelectElement)e.inputElement=[e.inputElement];else if(e.inputElement instanceof NodeList){if(0===e.inputElement.length)throw new Error("inputElement parameter length is 0");const t=[];e.inputElement.forEach(e=>{t.push(e)}),e.inputElement=t}if("string"==typeof e.rule&&(e.rule=[[e.rule,{}]]),e.rule=e.rule.map(e=>"string"==typeof e?[e,{}]:e),void 0===e.errorMessage?e.errorMessage={}:"string"==typeof e.errorMessage&&(e.errorMessage={default:e.errorMessage}),e.errorMessage=Object.assign({default:"The value has error."},e.errorMessage),void 0===e.errorElement)e.errorMessage=void 0;else if("string"==typeof e.errorElement){const t=e.errorElement,r=this.form.querySelector(e.errorElement);if(null===r)throw new Error(`errorElement parameter "${t}" is not found in the form.`);e.errorElement=r}void 0===e.event?e.event=[]:"string"==typeof e.event&&(e.event=[e.event]),void 0===e.name&&(e.name=u());const t=e.inputElement[0].tagName.toLowerCase();let r="";r="input"===t?e.inputElement[0].getAttribute("type"):t,"password"!==r&&"search"!==r&&"tel"!==r&&"email"!==r&&"url"!==r&&"number"!==r&&"datetime"!==r&&"date"!==r&&"month"!==r&&"week"!==r&&"time"!==r&&"datetime-local"!==r||(r="text"),e.inputElement.forEach(t=>{e.event.forEach(r=>{t.addEventListener(r,()=>{this.validate(e.name)})})});const n=Object.assign({},e,{tagName:t,type:r,error:[],displayError:void 0!==e.errorElement});return this.inputsRules.set(n.name,n),n}hasError(){let e=!1;return this.inputsRules.forEach((t,r)=>{t.error.length>0&&(e=!0)}),e}getRuleUnit(e){const t=this.inputsRules.get(e);if(void 0===t)throw new Error(e+" is not found.");return t}getInputValue(e){let t="";if("text"===e.type&&(t=e.inputElement[0].value),"radio"===e.type)for(let r=0,n=e.inputElement.length;r<n;r++){const n=e.inputElement[r];if(n.checked){t=n.value;break}}if("checkbox"===e.type){const r=e.inputElement[0];r.checked&&(t=r.value)}if("select"===e.type){const r=e.inputElement[0];t=r.options[r.options.selectedIndex].value}return t}clear(e){e.error=[],e.displayError&&(e.errorElement.innerHTML="")}allClear(){this.inputsRules.forEach((e,t)=>this.clear(this.getRuleUnit(t)))}validate(e){const t=this.getRuleUnit(e);let r=this.getInputValue(t);void 0!==t.valueFilter&&(r=t.valueFilter.bind(this)(r,p)),this.clear(t);for(const[e,n]of t.rule)p.validate(e,r,n)||t.error.push(e);return t.error.length>0&&t.displayError&&this.displayError(t),0===t.error.length}allValidate(){this.inputsRules.forEach((e,t)=>this.validate(t))}displayError(e){if(!e.displayError||0===e.error.length)return;const t=[],r=p.config.errorMessageWrapper;for(const n of e.error){if("default"===n)continue;const i=void 0===e.errorMessage[n]?`The value failed "${n}" validation rule.`:e.errorMessage[n];t.push(`<${r}>${i}</${r}>`)}const n=p.config.verbose?t.join(""):`<${r}>${e.errorMessage.default}</${r}>`;e.errorElement.innerHTML=n}parseAttrStr2Arr(e){e=`[${e=e.trim().replace(/\s*([0-9a-z\-_]+)\s*,/gim,"'$1',").replace(/\s*([0-9a-zA-Z\-_]+)$/,"'$1'").replace(/\/(.+)\/([gimsuy]*)/,'"/$1/$2"')}]`.replace(/'/g,'"');return JSON.parse(e).map(e=>this.parseString2rightType(e))}parseString2rightType(e){if(Array.isArray(e))e=e.map(e=>this.parseString2rightType(e));else if("object"==typeof e)for(const t in e)e[t]=this.parseString2rightType(e[t]);else if("string"==typeof e){const t=e.match(/(\/.+\/)([gimsuy]*)/);null!==t&&(t[1]=t[1].replace(/^\//,"").replace(/\/$/,""),e=""===t[2]?new RegExp(t[1]):new RegExp(t[1],t[2]))}return e}}p.config={customAttrPrefix:"k-",errorMessageWrapper:"span",verbose:!0,errorClassName:"kensho-has-error",autocomplete:!1,HTML5novalidate:!0},p.rule=t,p.plugin=n;for(const[e,t]of Object.entries(l))p.rule.add(e,t);for(const[e,t]of Object.entries(a))p.plugin.add(e,t);export{p as Kensho};
